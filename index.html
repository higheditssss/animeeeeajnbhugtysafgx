<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>HIGHEDITS</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;0,900;1,700&family=Barlow+Condensed:wght@400;600;700;800;900&family=Barlow:wght@300;400;500&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}
:root{
  --black:#000;--dark:#0a0a0a;--mid:#111;
  --border:rgba(255,255,255,0.07);
  --white:#fff;--red:#888;--gold:#aaa;
  --grey:#444;--grey2:#666;--text:#999;
  --fd:'Barlow Condensed',sans-serif;
  --fs:'Playfair Display',serif;
  --fb:'Barlow',sans-serif;
}
/* Grey/black pattern overlay */
body::before{
  content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
  background-image:
    linear-gradient(rgba(255,255,255,0.018) 1px,transparent 1px),
    linear-gradient(90deg,rgba(255,255,255,0.018) 1px,transparent 1px);
  background-size:40px 40px;
}
html{scroll-behavior:smooth;}
body{font-family:var(--fb);background:var(--black);color:var(--text);overflow-x:hidden;-webkit-font-smoothing:antialiased;-webkit-tap-highlight-color:transparent;}
#root{position:relative;z-index:1;}
img{display:block;max-width:100%;}
*::-webkit-scrollbar{width:3px;height:3px;}
*::-webkit-scrollbar-track{background:transparent;}
*::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.09);}
input,select,button{font-family:inherit;}
@keyframes fadeUp{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
@keyframes fadeIn{from{opacity:0;}to{opacity:1;}}
@keyframes scaleIn{from{opacity:0;transform:scale(0.95);}to{opacity:1;transform:scale(1);}}
@keyframes heroKen{from{transform:scale(1.06);}to{transform:scale(1);}}
@keyframes spin{to{transform:rotate(360deg);}}
@keyframes slideUp{from{opacity:0;transform:translateY(30px);}to{opacity:1;transform:translateY(0);}}
</style>
</head>
<body>
<!-- CCU XML Import -->
<link rel="import" href="ccu.xml" type="application/xml" id="ccu-xml-import">
<script>
  // CCU XML loader fallback
  (function(){
    try{
      var xhr=new XMLHttpRequest();
      xhr.open('GET','ccu.xml',true);
      xhr.onload=function(){if(xhr.status===200){window._ccuXML=xhr.responseXML||xhr.responseText;}};
      xhr.send();
    }catch(e){}
  })();
</script>
<div id="root"></div>
<script type="text/babel">
const {useState,useEffect,useRef,useMemo,useCallback}=React;
const STORAGE_KEY='aniverse_v3_library';
const MUSIC_KEY='highedits_music';
const STATUS_META={
  watching:    {label:'UrmƒÉresc',   color:'#7c8fff',bg:'rgba(124,143,255,0.13)'},
  completed:   {label:'Terminat',   color:'#4ecdc4',bg:'rgba(78,205,196,0.13)'},
  plan_to_watch:{label:'Plan',      color:'#ff6b9d',bg:'rgba(255,107,157,0.13)'},
  dropped:     {label:'Dropped',    color:'#ff4444',bg:'rgba(255,68,68,0.13)'},
};
function getLib(){try{return JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]');}catch{return[];}}
function getMusic(){try{return JSON.parse(localStorage.getItem(MUSIC_KEY)||'[]');}catch{return[];}}
function useIsMobile(){
  const[m,setM]=useState(()=>window.innerWidth<768);
  useEffect(()=>{
    const h=()=>setM(window.innerWidth<768);
    window.addEventListener('resize',h);return()=>window.removeEventListener('resize',h);
  },[]);
  return m;
}

/* ‚îÄ‚îÄ‚îÄ SPINNER ‚îÄ‚îÄ‚îÄ */
function Spin({size=20}){
  return <span style={{display:'inline-block',width:size,height:size,border:'2px solid rgba(255,255,255,0.07)',borderTopColor:'var(--red)',borderRadius:'50%',animation:'spin 0.7s linear infinite',verticalAlign:'middle',flexShrink:0}}/>;
}

/* ‚îÄ‚îÄ‚îÄ MUSIC PLAYER (floating corner widget) ‚îÄ‚îÄ‚îÄ */
function MusicPlayer(){
  const[tracks,setTracks]=useState(getMusic);
  const[idx,setIdx]=useState(0);
  const[playing,setPlaying]=useState(false);
  const[progress,setProgress]=useState(0);
  const[duration,setDuration]=useState(0);
  const[volume,setVolume]=useState(0.8);
  const[collapsed,setCollapsed]=useState(false);
  const[visible,setVisible]=useState(false);
  const[hovered,setHovered]=useState(false);
  const audioRef=useRef(null);
  const mob=useIsMobile();

  useEffect(()=>{
    const sync=()=>{const fresh=getMusic();setTracks(prev=>JSON.stringify(prev)===JSON.stringify(fresh)?prev:fresh);};
    window.addEventListener('storage',sync);
    const id=setInterval(sync,1500);
    return()=>{window.removeEventListener('storage',sync);clearInterval(id);};
  },[]);

  useEffect(()=>{if(tracks.length>0)setVisible(true);},[tracks.length]);

  const cur=tracks[idx]||null;
  const isYT=cur?.type==='youtube';
  const isSP=cur?.type==='spotify';
  const isMP3=cur?.type==='mp3';

  useEffect(()=>{
    if(!audioRef.current||!isMP3||!cur)return;
    audioRef.current.src=cur.src||'';
    audioRef.current.volume=volume;
    if(playing)audioRef.current.play().catch(()=>{});
    else audioRef.current.pause();
  },[idx,cur,isMP3]);

  useEffect(()=>{if(audioRef.current)audioRef.current.volume=volume;},[volume]);

  useEffect(()=>{
    const a=audioRef.current; if(!a)return;
    const onTime=()=>setProgress(a.currentTime);
    const onDur=()=>setDuration(a.duration||0);
    const onEnd=()=>next();
    a.addEventListener('timeupdate',onTime);
    a.addEventListener('durationchange',onDur);
    a.addEventListener('ended',onEnd);
    return()=>{a.removeEventListener('timeupdate',onTime);a.removeEventListener('durationchange',onDur);a.removeEventListener('ended',onEnd);};
  },[idx]);

  const togglePlay=()=>{
    if(isMP3&&audioRef.current){
      if(playing)audioRef.current.pause();
      else audioRef.current.play().catch(()=>{});
      setPlaying(p=>!p);
    } else if(isYT){
      setPlaying(p=>!p);
    } else if(isSP){
      window.open(`https://open.spotify.com/track/${cur.spotifyId}`,'_blank');
    }
  };

  const prev=()=>{if(tracks.length<2)return;setIdx(i=>(i-1+tracks.length)%tracks.length);setProgress(0);setPlaying(false);setTimeout(()=>setPlaying(true),100);};
  const next=()=>{if(tracks.length<2)return;setIdx(i=>(i+1)%tracks.length);setProgress(0);setPlaying(false);setTimeout(()=>setPlaying(true),100);};

  const seek=e=>{
    if(!audioRef.current||!duration)return;
    const rect=e.currentTarget.getBoundingClientRect();
    audioRef.current.currentTime=((e.clientX-rect.left)/rect.width)*duration;
  };

  const fmtTime=s=>{if(!s||isNaN(s))return'0:00';return`${Math.floor(s/60)}:${String(Math.floor(s%60)).padStart(2,'0')}`;}
  const pct=duration>0?progress/duration*100:0;

  if(!visible||tracks.length===0)return null;

  const typeLabel=cur?.type==='youtube'?'YT':cur?.type==='spotify'?'SP':'MP3';
  // cover: prefer track image, fallback to vinyl CSS
  const cover=cur?.image||cur?.cover||null;

  /* Cover art square with animated ring when playing */
  const CoverArt=({size=44})=>(
    <div style={{
      width:size,height:size,borderRadius:mob?8:10,flexShrink:0,
      position:'relative',overflow:'hidden',
      background:'#111',
      boxShadow:playing?`0 0 0 2px rgba(255,255,255,0.15), 0 4px 16px rgba(0,0,0,0.6)`:'0 2px 8px rgba(0,0,0,0.5)',
      transition:'box-shadow .3s',
    }}>
      {cover
        ? <img src={cover} alt="" style={{width:'100%',height:'100%',objectFit:'cover',display:'block'}}/>
        : (
          /* Vinyl fallback */
          <div style={{
            width:'100%',height:'100%',borderRadius:'50%',
            background:'radial-gradient(circle, #1a1a1a 28%, #0d0d0d 29%, #1c1c1c 44%, #111 45%, #1a1a1a 59%, #0d0d0d 60%, #222 74%, #111 75%, #1e1e1e 100%)',
            animation:playing?'vinylSpin 3s linear infinite':'none',
            display:'flex',alignItems:'center',justifyContent:'center',
          }}>
            <div style={{width:Math.round(size*0.22),height:Math.round(size*0.22),borderRadius:'50%',background:playing?'#888':'#333',border:'2px solid #111'}}/>
          </div>
        )
      }
      {/* Playing overlay shimmer */}
      {playing&&cover&&(
        <div style={{position:'absolute',inset:0,background:'linear-gradient(135deg,rgba(255,255,255,0.06) 0%,transparent 60%)',pointerEvents:'none'}}/>
      )}
    </div>
  );

  /* Animated waveform */
  const Waveform=({h=14})=>(
    <div style={{display:'flex',alignItems:'center',gap:2,height:h}}>
      {[0.45,0.8,1,0.6,0.9,0.5].map((v,i)=>(
        <div key={i} style={{
          width:2,borderRadius:1,
          height:`${v*100}%`,
          background:'rgba(255,255,255,0.35)',
          animation:playing?`wave${i%4} ${0.45+i*0.09}s ease-in-out infinite alternate`:'none',
          transformOrigin:'center',
        }}/>
      ))}
    </div>
  );

  /* ‚îÄ‚îÄ COLLAPSED: small pill with cover ‚îÄ‚îÄ */
  if(collapsed){
    return(
      <>
      <audio ref={audioRef} style={{display:'none'}}/>
      <div
        onClick={()=>setCollapsed(false)}
        style={{
          position:'fixed',bottom:mob?14:24,right:mob?14:24,zIndex:700,
          display:'flex',alignItems:'center',gap:0,
          background:'rgba(10,10,10,0.97)',
          border:'1px solid rgba(255,255,255,0.1)',
          borderRadius:mob?12:14,
          backdropFilter:'blur(24px)',
          boxShadow:'0 8px 32px rgba(0,0,0,0.65)',
          cursor:'pointer',
          overflow:'hidden',
          animation:'popIn .3s cubic-bezier(.34,1.56,.64,1)',
          transition:'transform .2s,box-shadow .2s',
          maxWidth:mob?200:220,
        }}
        onMouseEnter={e=>{e.currentTarget.style.transform='scale(1.03)';e.currentTarget.style.boxShadow='0 12px 40px rgba(0,0,0,0.75)';}}
        onMouseLeave={e=>{e.currentTarget.style.transform='scale(1)';e.currentTarget.style.boxShadow='0 8px 32px rgba(0,0,0,0.65)';}}
        title={cur?.title}
      >
        {/* Cover thumbnail */}
        <div style={{width:mob?40:44,height:mob?40:44,flexShrink:0,overflow:'hidden',position:'relative'}}>
          {cover
            ? <img src={cover} alt="" style={{width:'100%',height:'100%',objectFit:'cover',display:'block'}}/>
            : <div style={{width:'100%',height:'100%',background:'#1a1a1a',display:'flex',alignItems:'center',justifyContent:'center',fontSize:16}}>‚ô´</div>
          }
          {playing&&<div style={{position:'absolute',inset:0,background:'rgba(0,0,0,0.3)',display:'flex',alignItems:'center',justifyContent:'center'}}><Waveform h={12}/></div>}
        </div>
        {/* Title */}
        <div style={{padding:mob?'0 10px':'0 12px',minWidth:0,flex:1}}>
          <div style={{
            fontFamily:'var(--fd)',fontWeight:700,fontSize:mob?11:12,
            color:'rgba(255,255,255,0.85)',
            whiteSpace:'nowrap',overflow:'hidden',textOverflow:'ellipsis',
          }}>{cur?.title}</div>
        </div>
        {/* Play indicator dot */}
        {playing&&<div style={{width:6,height:6,borderRadius:'50%',background:'#fff',marginRight:10,flexShrink:0,animation:'pulse 1.4s ease-in-out infinite',boxShadow:'0 0 5px rgba(255,255,255,0.5)'}}/>}
      </div>
      {isYT&&cur&&<iframe key={`yt-${cur.ytId}`} src={`https://www.youtube.com/embed/${cur.ytId}?autoplay=${playing?1:0}&enablejsapi=1`} style={{width:1,height:1,opacity:0,position:'fixed',pointerEvents:'none'}} allow="autoplay" title="yt"/>}
      </>
    );
  }

  /* ‚îÄ‚îÄ EXPANDED CARD ‚îÄ‚îÄ */
  // Mobile: compact horizontal pill-card; Desktop: vertical card 272px
  const pad=mob?'10px 10px 10px':' 14px 14px 12px';
  const coverSize=mob?46:52;

  return(
    <>
    <audio ref={audioRef} style={{display:'none'}}/>
    <style>{`
      @keyframes vinylSpin{to{transform:rotate(360deg);}}
      @keyframes popIn{from{opacity:0;transform:scale(0.75);}to{opacity:1;transform:scale(1);}}
      @keyframes wave0{from{transform:scaleY(0.3);}to{transform:scaleY(1);}}
      @keyframes wave1{from{transform:scaleY(0.5);}to{transform:scaleY(0.85);}}
      @keyframes wave2{from{transform:scaleY(0.25);}to{transform:scaleY(0.8);}}
      @keyframes wave3{from{transform:scaleY(0.6);}to{transform:scaleY(1);}}
      @keyframes slideInCorner{from{opacity:0;transform:translateY(12px) scale(0.96);}to{opacity:1;transform:translateY(0) scale(1);}}
    `}</style>

    <div
      onMouseEnter={()=>setHovered(true)}
      onMouseLeave={()=>setHovered(false)}
      style={{
        position:'fixed',
        bottom:mob?14:24,
        right:mob?14:24,
        zIndex:700,
        width:mob?'calc(100vw - 28px)':272,
        background:'rgba(7,7,7,0.97)',
        border:'1px solid rgba(255,255,255,0.08)',
        borderRadius:mob?14:16,
        backdropFilter:'blur(36px)',
        boxShadow:'0 20px 60px rgba(0,0,0,0.8), 0 0 0 1px rgba(255,255,255,0.03) inset',
        animation:'slideInCorner .4s cubic-bezier(.16,1,.3,1)',
        overflow:'hidden',
      }}
    >
      {/* Hairline top accent */}
      <div style={{height:1,background:'linear-gradient(90deg,transparent,rgba(255,255,255,0.1),transparent)'}}/>

      <div style={{padding:pad}}>
        {/* ‚îÄ‚îÄ Row 1: cover + info + collapse ‚îÄ‚îÄ */}
        <div style={{display:'flex',alignItems:'center',gap:10,marginBottom:mob?8:10}}>
          <CoverArt size={coverSize}/>

          <div style={{flex:1,minWidth:0}}>
            {/* type badge + waveform */}
            <div style={{display:'flex',alignItems:'center',gap:5,marginBottom:2}}>
              <span style={{
                fontFamily:'var(--fd)',fontWeight:700,fontSize:mob?7:7,letterSpacing:1.5,
                textTransform:'uppercase',color:'rgba(255,255,255,0.22)',
                border:'1px solid rgba(255,255,255,0.09)',padding:'1px 4px',borderRadius:2,
              }}>{typeLabel}</span>
              {playing&&<Waveform h={mob?11:13}/>}
            </div>
            <div style={{
              fontFamily:'var(--fd)',fontWeight:700,
              fontSize:mob?12:13,
              color:'rgba(255,255,255,0.92)',
              whiteSpace:'nowrap',overflow:'hidden',textOverflow:'ellipsis',
              lineHeight:1.25,
            }}>{cur?.title}</div>
            {cur?.artist&&<div style={{
              fontFamily:'var(--fd)',fontSize:mob?10:10,color:'rgba(255,255,255,0.28)',
              marginTop:1,whiteSpace:'nowrap',overflow:'hidden',textOverflow:'ellipsis',
            }}>{cur.artist}</div>}
          </div>

          <button
            onClick={()=>setCollapsed(true)}
            style={{
              background:'none',border:'none',
              color:'rgba(255,255,255,0.18)',
              fontSize:mob?12:13,cursor:'pointer',
              padding:'4px 4px',lineHeight:1,flexShrink:0,
              transition:'color .15s',borderRadius:6,
              alignSelf:'flex-start',
            }}
            onMouseEnter={e=>e.currentTarget.style.color='rgba(255,255,255,0.55)'}
            onMouseLeave={e=>e.currentTarget.style.color='rgba(255,255,255,0.18)'}
          >‚úï</button>
        </div>

        {/* ‚îÄ‚îÄ Seek bar (MP3 only) ‚îÄ‚îÄ */}
        {isMP3&&(
          <div style={{marginBottom:mob?7:8}}>
            <div
              onClick={seek}
              style={{
                height:mob?2:3,background:'rgba(255,255,255,0.07)',
                borderRadius:2,cursor:'pointer',position:'relative',
                marginBottom:mob?3:4,
              }}
            >
              <div style={{
                width:`${pct}%`,height:'100%',
                background:'rgba(255,255,255,0.5)',
                borderRadius:2,transition:'width .2s linear',
              }}/>
              <div style={{
                position:'absolute',top:'50%',left:`${pct}%`,
                transform:'translate(-50%,-50%)',
                width:mob?6:8,height:mob?6:8,borderRadius:'50%',
                background:'#fff',
                opacity:hovered?1:0,transition:'opacity .2s',
                boxShadow:'0 0 5px rgba(255,255,255,0.5)',
              }}/>
            </div>
            <div style={{display:'flex',justifyContent:'space-between'}}>
              <span style={{fontFamily:'var(--fd)',fontSize:mob?8:9,color:'rgba(255,255,255,0.2)'}}>{fmtTime(progress)}</span>
              <span style={{fontFamily:'var(--fd)',fontSize:mob?8:9,color:'rgba(255,255,255,0.2)'}}>{fmtTime(duration)}</span>
            </div>
          </div>
        )}

        {/* ‚îÄ‚îÄ Controls row ‚îÄ‚îÄ */}
        <div style={{display:'flex',alignItems:'center',gap:mob?5:6}}>
          {tracks.length>1&&(
            <button onClick={prev} style={{
              width:mob?28:30,height:mob?28:30,borderRadius:mob?7:8,
              background:'rgba(255,255,255,0.04)',
              border:'1px solid rgba(255,255,255,0.06)',
              color:'rgba(255,255,255,0.38)',
              fontSize:mob?11:12,cursor:'pointer',
              display:'flex',alignItems:'center',justifyContent:'center',
              transition:'all .15s',flexShrink:0,
            }}
            onMouseEnter={e=>{e.currentTarget.style.background='rgba(255,255,255,0.09)';e.currentTarget.style.color='rgba(255,255,255,0.85)';}}
            onMouseLeave={e=>{e.currentTarget.style.background='rgba(255,255,255,0.04)';e.currentTarget.style.color='rgba(255,255,255,0.38)';}}>‚èÆ</button>
          )}

          <button onClick={togglePlay} style={{
            width:mob?36:40,height:mob?36:40,
            borderRadius:mob?10:11,
            background:'rgba(255,255,255,0.1)',
            border:'1px solid rgba(255,255,255,0.13)',
            color:'#fff',fontSize:mob?14:15,cursor:'pointer',
            display:'flex',alignItems:'center',justifyContent:'center',
            transition:'all .15s',flexShrink:0,
            boxShadow:playing?'0 0 18px rgba(255,255,255,0.07)':'none',
          }}
          onMouseEnter={e=>{e.currentTarget.style.background='rgba(255,255,255,0.17)';e.currentTarget.style.transform='scale(1.06)';}}
          onMouseLeave={e=>{e.currentTarget.style.background='rgba(255,255,255,0.1)';e.currentTarget.style.transform='scale(1)';}}>
            {isSP?'‚ô´':playing?'‚è∏':'‚ñ∂'}
          </button>

          {tracks.length>1&&(
            <button onClick={next} style={{
              width:mob?28:30,height:mob?28:30,borderRadius:mob?7:8,
              background:'rgba(255,255,255,0.04)',
              border:'1px solid rgba(255,255,255,0.06)',
              color:'rgba(255,255,255,0.38)',
              fontSize:mob?11:12,cursor:'pointer',
              display:'flex',alignItems:'center',justifyContent:'center',
              transition:'all .15s',flexShrink:0,
            }}
            onMouseEnter={e=>{e.currentTarget.style.background='rgba(255,255,255,0.09)';e.currentTarget.style.color='rgba(255,255,255,0.85)';}}
            onMouseLeave={e=>{e.currentTarget.style.background='rgba(255,255,255,0.04)';e.currentTarget.style.color='rgba(255,255,255,0.38)';}}>‚è≠</button>
          )}

          {/* Volume ‚Äî desktop only */}
          {isMP3&&!mob&&(
            <div style={{marginLeft:2,display:'flex',alignItems:'center',gap:5}}>
              <span style={{fontSize:10,color:'rgba(255,255,255,0.18)'}}>‚ô™</span>
              <input type="range" min={0} max={1} step={0.05} value={volume}
                onChange={e=>setVolume(Number(e.target.value))}
                style={{width:48,accentColor:'rgba(255,255,255,0.45)',cursor:'pointer',opacity:.55}}/>
            </div>
          )}

          {tracks.length>1&&(
            <span style={{
              marginLeft:'auto',
              fontFamily:'var(--fd)',fontWeight:700,fontSize:mob?8:9,
              color:'rgba(255,255,255,0.13)',letterSpacing:1.5,
            }}>{String(idx+1).padStart(2,'0')}/{String(tracks.length).padStart(2,'0')}</span>
          )}
        </div>

        {/* YT hidden */}
        {isYT&&cur&&(
          <iframe key={`yt-${cur.ytId}`} src={`https://www.youtube.com/embed/${cur.ytId}?autoplay=${playing?1:0}&enablejsapi=1`} style={{width:1,height:1,opacity:0,position:'absolute',pointerEvents:'none'}} allow="autoplay" title="yt"/>
        )}
        {isSP&&(
          <div style={{marginTop:6,textAlign:'center',fontSize:mob?9:10,color:'rgba(255,255,255,0.18)',fontFamily:'var(--fd)',letterSpacing:.8}}>
            ApasƒÉ ‚ñ∂ pentru Spotify ‚Üí
          </div>
        )}
      </div>

      <div style={{height:1,background:'linear-gradient(90deg,transparent,rgba(255,255,255,0.04),transparent)'}}/>
    </div>
    </>
  );
}

/* ‚îÄ‚îÄ‚îÄ NAVBAR ‚îÄ‚îÄ‚îÄ */
function Navbar({page,setPage,scrolled}){
  const[open,setOpen]=useState(false);
  const mob=useIsMobile();
  const bg=scrolled||open||page!=='home';
  return(
    <>
    <nav style={{
      position:'fixed',top:0,left:0,right:0,zIndex:600,height:56,
      display:'flex',alignItems:'center',
      padding:'0 clamp(16px,4vw,44px)',
      background:bg?'rgba(0,0,0,0.95)':'transparent',
      backdropFilter:bg?'blur(20px)':'none',
      borderBottom:bg?'1px solid var(--border)':'none',
      transition:'background .4s,backdrop-filter .4s',
    }}>
      <div onClick={()=>{setPage('home');setOpen(false);}} style={{
        fontFamily:'var(--fd)',fontWeight:900,fontSize:20,letterSpacing:5,
        textTransform:'uppercase',cursor:'pointer',color:'var(--white)',userSelect:'none',flexShrink:0,
      }}>HIGH<span style={{color:'var(--red)'}}>EDITS</span></div>

      {mob?(
        <button onClick={()=>setOpen(o=>!o)} style={{
          marginLeft:'auto',background:'none',border:'none',
          color:'var(--white)',fontSize:24,cursor:'pointer',padding:'4px 8px',lineHeight:1,
        }}>{open?'‚úï':'‚ò∞'}</button>
      ):(
        <div style={{display:'flex',gap:2,marginLeft:44}}>
          {[['home','Home'],['list','Lista Mea'],['discover','DescoperƒÉ']].map(([id,lbl])=>(
            <button key={id} onClick={()=>setPage(id)} style={{
              fontFamily:'var(--fd)',fontWeight:700,fontSize:11,letterSpacing:2.5,textTransform:'uppercase',
              color:page===id?'var(--white)':'rgba(255,255,255,0.37)',
              background:'none',border:'none',
              borderBottom:page===id?'2px solid var(--red)':'2px solid transparent',
              padding:'6px 16px',cursor:'pointer',transition:'color .2s',
            }}>{lbl}</button>
          ))}
        </div>
      )}
    </nav>

    {mob&&open&&(
      <div style={{
        position:'fixed',top:56,left:0,right:0,zIndex:599,
        background:'rgba(0,0,0,0.97)',borderBottom:'1px solid var(--border)',
        padding:'8px 0',animation:'fadeIn .15s',
      }}>
        {[['home','Home'],['list','Lista Mea'],['discover','DescoperƒÉ']].map(([id,lbl])=>(
          <button key={id} onClick={()=>{setPage(id);setOpen(false);}} style={{
            display:'block',width:'100%',textAlign:'left',
            fontFamily:'var(--fd)',fontWeight:700,fontSize:15,letterSpacing:3,textTransform:'uppercase',
            color:page===id?'var(--white)':'rgba(255,255,255,0.44)',
            background:'none',border:'none',
            borderLeft:page===id?'3px solid var(--red)':'3px solid transparent',
            padding:'15px 24px',cursor:'pointer',
          }}>{lbl}</button>
        ))}
      </div>
    )}
    </>
  );
}

/* ‚îÄ‚îÄ‚îÄ HERO ‚îÄ‚îÄ‚îÄ */
function Hero({library}){
  const[list,setList]=useState([]);
  const[idx,setIdx]=useState(0);
  const[ready,setReady]=useState(false);
  const intRef=useRef(null);
  const mob=useIsMobile();

  useEffect(()=>{
    setList(library.slice(0,6));
    setReady(true);setIdx(0);
  },[library]);

  useEffect(()=>{
    if(list.length<2)return;
    clearInterval(intRef.current);
    intRef.current=setInterval(()=>setIdx(i=>(i+1)%list.length),7000);
    return()=>clearInterval(intRef.current);
  },[list]);

  if(!ready) return(
    <div style={{height:'100vh',display:'flex',alignItems:'center',justifyContent:'center',flexDirection:'column',gap:14}}>
      <Spin size={32}/><div style={{fontFamily:'var(--fd)',fontSize:11,letterSpacing:4,textTransform:'uppercase',color:'var(--grey2)'}}>Se √ÆncarcƒÉ...</div>
    </div>
  );

  if(!list.length) return(
    <div style={{
      height:'calc(100vh - 56px)',marginTop:56,
      display:'flex',alignItems:'center',justifyContent:'center',
      flexDirection:'column',gap:12,padding:24,textAlign:'center',
    }}>
      <div style={{fontSize:64,opacity:0.1}}>üéå</div>
      <div style={{fontFamily:'var(--fd)',fontWeight:900,fontSize:mob?32:52,letterSpacing:-1,textTransform:'uppercase',color:'rgba(255,255,255,0.06)'}}>COLEC»öIE GOALƒÇ</div>
      <div style={{fontFamily:'var(--fd)',fontSize:11,letterSpacing:3,color:'var(--grey)',textTransform:'uppercase',marginTop:4}}>AdaugƒÉ anime din panoul admin</div>
    </div>
  );

  const cur=list[idx];
  const sm=STATUS_META[cur.status];

  return(
    <div style={{position:'relative',height:'100vh',minHeight:mob?580:600,overflow:'hidden'}}>
      {/* BG layer */}
      <div key={`bg${cur.mal_id}`} style={{
        position:'absolute',inset:0,
        backgroundImage:`url('${cur.image}')`,
        backgroundSize:'cover',backgroundPosition:'center 20%',
        filter:'brightness(0.27)',
        animation:'heroKen 8s ease-out forwards',
      }}/>
      <div style={{position:'absolute',inset:0,background:'linear-gradient(to top,#000 0%,rgba(0,0,0,0.6) 45%,rgba(0,0,0,0.05) 100%)'}}/>
      <div style={{position:'absolute',inset:0,background:'linear-gradient(100deg,rgba(0,0,0,0.75) 0%,transparent 60%)'}}/>

      {/* Content */}
      <div key={`c${idx}`} style={{
        position:'relative',zIndex:2,height:'100%',
        display:'flex',flexDirection:'column',justifyContent:'flex-end',
        padding:mob?'0 20px 72px':'0 clamp(24px,5vw,72px) 88px',
        maxWidth:mob?'100%':860,
        animation:'fadeUp .55s ease forwards',
      }}>
        <div style={{fontFamily:'var(--fd)',fontWeight:700,fontSize:10,letterSpacing:4,textTransform:'uppercase',color:'var(--red)',marginBottom:14,display:'flex',alignItems:'center',gap:10}}>
          <span style={{width:24,height:2,background:'var(--red)',display:'inline-block',flexShrink:0}}/>
          {cur.type||'Anime'}
          {sm&&<span style={{padding:'2px 9px',border:`1px solid ${sm.color}`,color:sm.color,fontFamily:'var(--fd)',fontWeight:700,fontSize:9,letterSpacing:2,marginLeft:6}}>{sm.label}</span>}
        </div>

        <h1 style={{
          fontFamily:'var(--fs)',fontWeight:900,
          fontSize:mob?'clamp(30px,9vw,50px)':'clamp(40px,6vw,80px)',
          lineHeight:1.0,color:'var(--white)',marginBottom:10,letterSpacing:-1,
          textShadow:'0 2px 24px rgba(0,0,0,0.5)',
        }}>{cur.title_english||cur.title}</h1>

        {cur.title_english&&cur.title_english!==cur.title&&(
          <div style={{fontFamily:'var(--fd)',fontSize:mob?11:14,color:'rgba(255,255,255,0.28)',marginBottom:12,letterSpacing:.5}}>{cur.title}</div>
        )}

        <div style={{display:'flex',gap:mob?14:22,marginBottom:14,flexWrap:'wrap',alignItems:'center'}}>
          {cur.score&&<span style={{fontFamily:'var(--fd)',fontWeight:800,fontSize:mob?13:16,color:'var(--gold)'}}>‚òÖ {cur.score}</span>}
          {cur.episodes&&<span style={{fontFamily:'var(--fd)',fontWeight:600,fontSize:12,color:'rgba(255,255,255,0.42)',letterSpacing:1}}>{cur.episodes} EP</span>}
          {cur.year&&<span style={{fontFamily:'var(--fd)',fontWeight:600,fontSize:12,color:'rgba(255,255,255,0.42)',letterSpacing:1}}>{cur.year}</span>}
          {cur.userScore&&<span style={{fontFamily:'var(--fd)',fontWeight:800,fontSize:11,color:'var(--red)',letterSpacing:.5}}>‚òÖ Scor meu: {cur.userScore}/10</span>}
        </div>

        {!mob&&(
          <div style={{display:'flex',gap:7,flexWrap:'wrap',marginBottom:18}}>
            {(cur.genres||[]).slice(0,4).map(g=>(
              <span key={g} style={{fontFamily:'var(--fd)',fontWeight:700,fontSize:10,letterSpacing:2,textTransform:'uppercase',padding:'4px 11px',border:'1px solid rgba(255,255,255,0.17)',color:'rgba(255,255,255,0.58)'}}>{g}</span>
            ))}
          </div>
        )}

        {mob&&(cur.genres||[]).length>0&&(
          <div style={{display:'flex',gap:6,flexWrap:'wrap',marginBottom:14}}>
            {(cur.genres||[]).slice(0,3).map(g=>(
              <span key={g} style={{fontFamily:'var(--fd)',fontWeight:700,fontSize:9,letterSpacing:1.5,textTransform:'uppercase',padding:'3px 9px',border:'1px solid rgba(255,255,255,0.14)',color:'rgba(255,255,255,0.5)'}}>{g}</span>
            ))}
          </div>
        )}

        {!mob&&cur.synopsis&&(
          <p style={{fontSize:13,lineHeight:1.75,color:'rgba(255,255,255,0.42)',maxWidth:500}}>
            {cur.synopsis.slice(0,165)}{cur.synopsis.length>165?'...':''}
          </p>
        )}
      </div>

      {/* Thumbnails desktop */}
      {!mob&&list.length>1&&(
        <div style={{position:'absolute',right:'clamp(24px,4vw,60px)',bottom:88,zIndex:3,display:'flex',flexDirection:'column',gap:8}}>
          {list.map((a,i)=>(
            <img key={a.mal_id} src={a.image_sm||a.image} onClick={()=>setIdx(i)} style={{
              width:44,height:62,objectFit:'cover',cursor:'pointer',
              opacity:i===idx?1:0.27,
              border:i===idx?'2px solid var(--white)':'2px solid transparent',
              transition:'opacity .3s,border-color .3s',
            }} alt=""/>
          ))}
        </div>
      )}

      {/* Dots mobile */}
      {mob&&list.length>1&&(
        <div style={{position:'absolute',bottom:28,left:0,right:0,zIndex:3,display:'flex',justifyContent:'center',gap:7}}>
          {list.map((_,i)=>(
            <button key={i} onClick={()=>setIdx(i)} style={{
              width:i===idx?22:6,height:6,padding:0,
              background:i===idx?'var(--white)':'rgba(255,255,255,0.22)',
              border:'none',cursor:'pointer',borderRadius:3,
              transition:'width .3s,background .3s',
            }}/>
          ))}
        </div>
      )}

      <div style={{position:'absolute',right:mob?18:'clamp(24px,4vw,60px)',top:68,zIndex:3,fontFamily:'var(--fd)',fontWeight:700,fontSize:11,letterSpacing:2,color:'rgba(255,255,255,0.25)'}}>
        {String(idx+1).padStart(2,'0')} / {String(list.length).padStart(2,'0')}
      </div>
    </div>
  );
}

/* ‚îÄ‚îÄ‚îÄ STATS BAR ‚îÄ‚îÄ‚îÄ */
function StatsBar({library}){
  const mob=useIsMobile();
  const w=library.filter(a=>a.status==='watching').length;
  const c=library.filter(a=>a.status==='completed').length;
  const sc=library.filter(a=>a.userScore).map(a=>a.userScore);
  const avg=sc.length?(sc.reduce((a,b)=>a+b,0)/sc.length).toFixed(1):'‚Äî';
  return(
    <div style={{display:'grid',gridTemplateColumns:`repeat(${mob?2:4},1fr)`,background:'var(--dark)',borderTop:'1px solid var(--border)'}}>
      {[['Total',library.length,'var(--white)'],['UrmƒÉresc',w,'#7c8fff'],['Terminate',c,'#4ecdc4'],['Scor Mediu',avg,'var(--gold)']].map(([l,v,col],i)=>(
        <div key={l} style={{
          padding:mob?'16px 0':'22px 0',textAlign:'center',
          borderRight:(mob?i%2===0:i<3)?'1px solid var(--border)':'none',
          borderBottom:mob&&i<2?'1px solid var(--border)':'none',
        }}>
          <div style={{fontFamily:'var(--fd)',fontWeight:900,fontSize:mob?30:42,lineHeight:1,color:col}}>{v}</div>
          <div style={{fontFamily:'var(--fd)',fontWeight:600,fontSize:9,letterSpacing:2.5,textTransform:'uppercase',color:'var(--grey2)',marginTop:5}}>{l}</div>
        </div>
      ))}
    </div>
  );
}

/* ‚îÄ‚îÄ‚îÄ FILTER BAR ‚îÄ‚îÄ‚îÄ */
function FilterBar({options,active,onChange}){
  const mob=useIsMobile();
  return(
    <div style={{display:'flex',overflowX:'auto',background:'var(--dark)',borderBottom:'1px solid var(--border)',padding:mob?'0 16px':'0 clamp(16px,4vw,64px)',scrollbarWidth:'none'}}>
      {options.map(([k,lbl])=>(
        <button key={k} onClick={()=>onChange(k)} style={{
          fontFamily:'var(--fd)',fontWeight:700,fontSize:mob?12:11,
          letterSpacing:2,textTransform:'uppercase',
          padding:mob?'14px 14px':'15px 18px',background:'none',border:'none',
          borderBottom:active===k?'2px solid var(--red)':'2px solid transparent',
          color:active===k?'white':'rgba(255,255,255,0.37)',
          cursor:'pointer',transition:'color .2s',flexShrink:0,whiteSpace:'nowrap',
        }}>{lbl}</button>
      ))}
    </div>
  );
}

/* ‚îÄ‚îÄ‚îÄ CARD ‚îÄ‚îÄ‚îÄ */
function Card({anime,onClick}){
  const[hov,setHov]=useState(false);
  const mob=useIsMobile();
  const sm=STATUS_META[anime.status]||STATUS_META.plan_to_watch;
  const prog=anime.episodes&&anime.epsWatched?Math.round(anime.epsWatched/anime.episodes*100):0;
  return(
    <div
      style={{position:'relative',cursor:'pointer',overflow:'hidden',background:'var(--mid)',aspectRatio:'2/3'}}
      onMouseEnter={()=>!mob&&setHov(true)}
      onMouseLeave={()=>setHov(false)}
      onClick={()=>onClick(anime)}
    >
      <img src={anime.image} loading="lazy" style={{
        width:'100%',height:'100%',objectFit:'cover',
        transition:'transform .5s ease,filter .4s',
        transform:hov?'scale(1.06)':'scale(1)',
        filter:hov?'brightness(0.38)':'brightness(0.88)',
      }} alt=""/>

      {anime.userScore&&(
        <div style={{position:'absolute',top:7,left:7,background:'rgba(0,0,0,0.85)',border:'1px solid rgba(255,209,102,0.4)',color:'var(--gold)',fontFamily:'var(--fd)',fontWeight:900,fontSize:13,padding:'2px 7px',zIndex:3}}>{anime.userScore}</div>
      )}

      {/* Always visible bottom */}
      <div style={{position:'absolute',bottom:0,left:0,right:0,background:'linear-gradient(to top,rgba(0,0,0,0.93) 0%,rgba(0,0,0,0.35) 55%,transparent)',padding:'28px 10px 10px'}}>
        <div style={{fontFamily:'var(--fd)',fontWeight:700,fontSize:12,lineHeight:1.3,color:'white',display:'-webkit-box',WebkitLineClamp:2,WebkitBoxOrient:'vertical',overflow:'hidden'}}>{anime.title_english||anime.title}</div>
        {mob&&sm&&(
          <div style={{marginTop:5,fontFamily:'var(--fd)',fontWeight:700,fontSize:9,letterSpacing:1.5,textTransform:'uppercase',padding:'2px 7px',display:'inline-block',border:`1px solid ${sm.color}`,color:sm.color,background:sm.bg}}>{sm.label}</div>
        )}
      </div>

      {/* Hover info desktop */}
      {!mob&&(
        <div style={{position:'absolute',inset:0,background:'linear-gradient(to top,rgba(0,0,0,0.97) 0%,rgba(0,0,0,0.28) 55%,transparent)',opacity:hov?1:0,transition:'opacity .3s',display:'flex',flexDirection:'column',justifyContent:'flex-end',padding:12,gap:6}}>
          <div style={{display:'flex',gap:4,flexWrap:'wrap'}}>
            {(anime.genres||[]).slice(0,2).map(g=>(
              <span key={g} style={{fontFamily:'var(--fd)',fontWeight:700,fontSize:9,letterSpacing:1.5,textTransform:'uppercase',padding:'2px 7px',border:'1px solid rgba(255,255,255,0.2)',color:'rgba(255,255,255,0.6)'}}>{g}</span>
            ))}
            {sm&&<span style={{fontFamily:'var(--fd)',fontWeight:700,fontSize:9,letterSpacing:1.5,textTransform:'uppercase',padding:'2px 7px',border:`1px solid ${sm.color}`,color:sm.color}}>{sm.label}</span>}
          </div>
          <div style={{fontFamily:'var(--fd)',fontSize:12,color:'var(--gold)',fontWeight:700}}>‚òÖ {anime.score||'N/A'}</div>
          <div style={{fontFamily:'var(--fd)',fontWeight:700,fontSize:13,color:'white',lineHeight:1.3}}>{anime.title_english||anime.title}</div>
        </div>
      )}

      {prog>0&&(
        <div style={{position:'absolute',bottom:0,left:0,width:'100%',height:3,background:'rgba(255,255,255,0.07)'}}>
          <div style={{width:`${prog}%`,height:'100%',background:'var(--red)'}}/>
        </div>
      )}
    </div>
  );
}

/* ‚îÄ‚îÄ‚îÄ GRID ‚îÄ‚îÄ‚îÄ */
function Grid({items,onCardClick,emptyMsg='NICIUN ANIME'}){
  const mob=useIsMobile();
  if(!items.length) return(
    <div style={{textAlign:'center',padding:mob?'60px 24px':'90px 40px'}}>
      <div style={{fontSize:mob?40:56,marginBottom:16,opacity:0.12}}>üéå</div>
      <div style={{fontFamily:'var(--fd)',fontWeight:900,fontSize:mob?28:48,letterSpacing:-1,textTransform:'uppercase',color:'rgba(255,255,255,0.05)',marginBottom:10}}>{emptyMsg}</div>
      <div style={{fontSize:13,color:'var(--grey)'}}>AdaugƒÉ anime din panoul admin</div>
    </div>
  );
  return(
    <div style={{display:'grid',gridTemplateColumns:mob?'repeat(auto-fill,minmax(120px,1fr))':'repeat(auto-fill,minmax(165px,1fr))',gap:2}}>
      {items.map(a=><Card key={a.mal_id} anime={a} onClick={onCardClick}/>)}
    </div>
  );
}

/* ‚îÄ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ‚îÄ */
function Modal({anime,onClose}){
  const mob=useIsMobile();
  const sm=STATUS_META[anime.status];
  const prog=anime.episodes&&anime.epsWatched?Math.round(anime.epsWatched/anime.episodes*100):0;

  const startY=useRef(null);
  const onTS=e=>{ startY.current=e.touches[0].clientY; };
  const onTM=e=>{ if(startY.current!==null&&e.touches[0].clientY-startY.current>80){onClose();startY.current=null;} };

  useEffect(()=>{
    const h=e=>{if(e.key==='Escape')onClose();};
    window.addEventListener('keydown',h);return()=>window.removeEventListener('keydown',h);
  },[onClose]);

  return(
    <div style={{
      position:'fixed',inset:0,zIndex:800,
      background:'rgba(0,0,0,0.88)',backdropFilter:'blur(7px)',
      display:'flex',alignItems:mob?'flex-end':'center',justifyContent:'center',
      padding:mob?0:24,animation:'fadeIn .22s ease',
    }} onClick={e=>e.target===e.currentTarget&&onClose()}>
      <div
        onTouchStart={mob?onTS:null}
        onTouchMove={mob?onTM:null}
        style={{
          background:'var(--dark)',
          border:mob?'none':'1px solid var(--border)',
          borderTop:'1px solid rgba(255,255,255,0.1)',
          maxWidth:mob?'100%':700,width:'100%',
          maxHeight:mob?'88vh':'88vh',
          overflowY:'auto',position:'relative',
          borderRadius:mob?'18px 18px 0 0':0,
          animation:mob?'slideUp .3s ease':'scaleIn .25s ease',
          paddingBottom:'env(safe-area-inset-bottom,0px)',
        }}
      >
        {mob&&<div style={{display:'flex',justifyContent:'center',padding:'12px 0 4px'}}><div style={{width:36,height:4,background:'rgba(255,255,255,0.13)',borderRadius:2}}/></div>}

        <button onClick={onClose} style={{position:'absolute',top:mob?14:12,right:14,zIndex:10,width:32,height:32,background:'rgba(0,0,0,0.7)',border:'1px solid var(--border)',color:'white',fontSize:16,cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center',borderRadius:mob?8:0}}>‚úï</button>

        {/* Banner */}
        <div style={{position:'relative',height:mob?155:195,overflow:'hidden'}}>
          <img src={anime.image} style={{width:'100%',height:'100%',objectFit:'cover',filter:'brightness(0.27)'}} alt=""/>
          <div style={{position:'absolute',inset:0,background:'linear-gradient(to top,var(--dark) 0%,transparent 100%)'}}/>
          <div style={{position:'absolute',inset:0,display:'flex',gap:mob?14:22,padding:mob?'14px 16px':'22px',alignItems:'flex-end'}}>
            <img src={anime.image} style={{width:mob?64:88,height:mob?92:126,objectFit:'cover',border:'2px solid rgba(255,255,255,0.13)',flexShrink:0}} alt=""/>
            <div style={{flex:1,minWidth:0}}>
              <h2 style={{fontFamily:mob?'var(--fd)':'var(--fs)',fontWeight:mob?800:900,fontSize:mob?17:25,lineHeight:1.1,marginBottom:mob?4:6,color:'var(--white)'}}>{anime.title_english||anime.title}</h2>
              {anime.title_english&&<div style={{fontFamily:'var(--fd)',fontSize:12,color:'rgba(255,255,255,0.32)',marginBottom:mob?6:9}}>{anime.title}</div>}
              <div style={{display:'flex',gap:6,flexWrap:'wrap'}}>
                {(anime.genres||[]).slice(0,mob?2:4).map(g=>(
                  <span key={g} style={{fontFamily:'var(--fd)',fontWeight:700,fontSize:9,letterSpacing:1.5,textTransform:'uppercase',padding:'3px 8px',border:'1px solid rgba(255,255,255,0.16)',color:'rgba(255,255,255,0.53)'}}>{g}</span>
                ))}
                {sm&&<span style={{fontFamily:'var(--fd)',fontWeight:700,fontSize:9,letterSpacing:1.5,textTransform:'uppercase',padding:'3px 8px',border:`1px solid ${sm.color}`,color:sm.color}}>{sm.label}</span>}
              </div>
            </div>
          </div>
        </div>

        {/* Stats grid */}
        <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:1,background:'var(--border)'}}>
          {[['‚òÖ '+(anime.score||'N/A'),'Score','var(--gold)'],
            [anime.episodes||'?','Episoade',null],
            [anime.type||'‚Äî','Tip',null],
            [anime.year||'‚Äî','An',null]
          ].map(([v,k,c])=>(
            <div key={k} style={{background:'rgba(0,0,0,0.5)',padding:mob?'10px 4px':'15px',textAlign:'center'}}>
              <div style={{fontFamily:'var(--fd)',fontWeight:900,fontSize:mob?15:21,color:c||'var(--white)'}}>{v}</div>
              <div style={{fontFamily:'var(--fd)',fontSize:9,letterSpacing:2,textTransform:'uppercase',color:'var(--grey2)',marginTop:2}}>{k}</div>
            </div>
          ))}
        </div>

        {/* Body */}
        <div style={{padding:mob?'16px 16px 24px':'26px'}}>
          {(anime.userScore||anime.epsWatched>0)&&(
            <div style={{marginBottom:16,padding:'10px 14px',background:'rgba(255,209,102,0.06)',borderLeft:'3px solid var(--gold)',display:'flex',flexWrap:'wrap',gap:14}}>
              {anime.userScore&&<span style={{fontFamily:'var(--fd)',fontWeight:700,fontSize:11,letterSpacing:1,textTransform:'uppercase',color:'var(--gold)'}}>‚òÖ Scor: {anime.userScore}/10</span>}
              {anime.epsWatched>0&&<span style={{fontFamily:'var(--fd)',fontWeight:700,fontSize:11,letterSpacing:1,textTransform:'uppercase',color:'rgba(255,209,102,0.55)'}}>üì∫ {anime.epsWatched}{anime.episodes?'/'+anime.episodes:''} ep</span>}
              {anime.notes&&<span style={{fontSize:12,color:'rgba(255,209,102,0.45)',fontStyle:'italic'}}>"{anime.notes}"</span>}
            </div>
          )}
          {prog>0&&(
            <div style={{marginBottom:16}}>
              <div style={{display:'flex',justifyContent:'space-between',fontFamily:'var(--fd)',fontSize:9,letterSpacing:2,textTransform:'uppercase',color:'var(--grey2)',marginBottom:5}}>
                <span>PROGRES</span><span>{prog}%</span>
              </div>
              <div style={{height:3,background:'rgba(255,255,255,0.07)'}}>
                <div style={{width:`${prog}%`,height:'100%',background:'var(--red)',transition:'width .6s ease'}}/>
              </div>
            </div>
          )}
          {anime.synopsis&&(
            <p style={{fontSize:mob?13:13,lineHeight:1.8,color:'rgba(255,255,255,0.48)',marginBottom:20}}>
              {anime.synopsis.slice(0,mob?260:480)}{anime.synopsis.length>(mob?260:480)?'...':''}
            </p>
          )}
          <div style={{display:'flex',justifyContent:'flex-end'}}>
            <a href={`https://myanimelist.net/anime/${anime.mal_id}`} target="_blank" rel="noreferrer" style={{
              fontFamily:'var(--fd)',fontWeight:700,fontSize:11,letterSpacing:2,textTransform:'uppercase',
              background:'transparent',color:'rgba(255,255,255,0.38)',
              border:'1px solid var(--border)',padding:'9px 18px',
              display:'inline-flex',alignItems:'center',gap:6,textDecoration:'none',
              transition:'color .2s',
            }}>MAL ‚Üó</a>
          </div>
        </div>
      </div>
    </div>
  );
}

/* ‚îÄ‚îÄ‚îÄ SECTION HEADER ‚îÄ‚îÄ‚îÄ */
function SecHead({title,accent,sub,action}){
  const mob=useIsMobile();
  return(
    <div style={{display:'flex',alignItems:'flex-end',justifyContent:'space-between',marginBottom:mob?18:26,paddingBottom:mob?13:17,borderBottom:'1px solid var(--border)'}}>
      <div>
        <h2 style={{fontFamily:'var(--fd)',fontWeight:900,fontSize:mob?26:38,letterSpacing:-.5,textTransform:'uppercase',lineHeight:1,color:'var(--white)'}}>
          {title}{accent&&<span style={{color:'var(--red)'}}> {accent}</span>}
        </h2>
        {sub&&<div style={{fontSize:11,color:'var(--grey2)',marginTop:4}}>{sub}</div>}
      </div>
      {action&&<button onClick={action.fn} style={{fontFamily:'var(--fd)',fontWeight:700,fontSize:10,letterSpacing:2.5,textTransform:'uppercase',background:'none',border:'none',color:'var(--grey2)',cursor:'pointer',flexShrink:0,transition:'color .2s'}} onMouseEnter={e=>e.currentTarget.style.color='white'} onMouseLeave={e=>e.currentTarget.style.color='var(--grey2)'}>{action.label} ‚Üí</button>}
    </div>
  );
}

/* ‚îÄ‚îÄ‚îÄ PAGES ‚îÄ‚îÄ‚îÄ */
function PageHome({library,setPage}){
  const[modal,setModal]=useState(null);
  const mob=useIsMobile();
  return(
    <div>
      <Hero library={library}/>
      <StatsBar library={library}/>
      <div style={{padding:mob?'30px 16px 60px':'56px clamp(16px,4vw,64px) 72px'}}>
        <SecHead title="RECENT" accent="ADƒÇUGATE" sub={`${library.length} titluri √Æn colec»õie`} action={library.length>6?{label:'Vezi toate',fn:()=>setPage('list')}:null}/>
        <Grid items={library.slice(0,mob?8:16)} onCardClick={setModal} emptyMsg="COLEC»öIE GOALƒÇ"/>
      </div>
      {modal&&<Modal anime={modal} onClose={()=>setModal(null)}/>}
    </div>
  );
}

function PageList({library}){
  const[filter,setFilter]=useState('all');
  const[modal,setModal]=useState(null);
  const mob=useIsMobile();
  const filtered=useMemo(()=>filter==='all'?library:library.filter(a=>a.status===filter),[library,filter]);
  return(
    <div style={{paddingTop:56}}>
      <div style={{padding:mob?'30px 16px 0':'44px clamp(16px,4vw,64px) 0'}}>
        <h1 style={{fontFamily:'var(--fd)',fontWeight:900,fontSize:mob?44:62,letterSpacing:-2,textTransform:'uppercase',lineHeight:1,color:'var(--white)'}}>LISTA <span style={{color:'var(--red)'}}>MEA</span></h1>
        <p style={{fontSize:12,color:'var(--grey2)',marginTop:6}}>{library.length} titluri</p>
      </div>
      <div style={{marginTop:20}}>
        <FilterBar options={[['all','Toate'],['watching','UrmƒÉresc'],['completed','Terminate'],['plan_to_watch','Plan'],['dropped','Dropped']]} active={filter} onChange={setFilter}/>
      </div>
      <div style={{padding:mob?'28px 16px 60px':'38px clamp(16px,4vw,64px) 72px'}}>
        <Grid items={filtered} onCardClick={setModal} emptyMsg={filter==='all'?'COLEC»öIE GOALƒÇ':'NIMIC AICI'}/>
      </div>
      {modal&&<Modal anime={modal} onClose={()=>setModal(null)}/>}
    </div>
  );
}

function PageDiscover({library}){
  const[filter,setFilter]=useState('top');
  const[items,setItems]=useState([]);
  const[loading,setLoading]=useState(false);
  const[modal,setModal]=useState(null);
  const mob=useIsMobile();
  const cache=useRef({});

  const paths={top:'/top/anime?limit=24',airing:'/top/anime?filter=airing&limit=24',upcoming:'/top/anime?filter=upcoming&limit=24',popular:'/top/anime?filter=bypopularity&limit=24'};

  useEffect(()=>{
    setLoading(true);setItems([]);
    const url='https://api.jikan.moe/v4'+paths[filter];
    if(cache.current[url]){setItems(cache.current[url]);setLoading(false);return;}
    fetch(url).then(r=>r.json()).then(d=>{
      const mapped=(d?.data||[]).map(a=>{
        const lib=library.find(x=>x.mal_id===a.mal_id)||{};
        return{...lib,mal_id:a.mal_id,title:a.title,title_english:a.title_english||null,
          image:a.images?.jpg?.large_image_url||a.images?.jpg?.image_url||'',
          image_sm:a.images?.jpg?.small_image_url||'',score:a.score,episodes:a.episodes,
          year:a.aired?.prop?.from?.year||null,genres:(a.genres||[]).map(g=>g.name),
          synopsis:a.synopsis||'',type:a.type||''};
      });
      cache.current[url]=mapped;setItems(mapped);setLoading(false);
    }).catch(()=>setLoading(false));
  },[filter]);

  return(
    <div style={{paddingTop:56}}>
      <div style={{padding:mob?'30px 16px 0':'44px clamp(16px,4vw,64px) 0'}}>
        <h1 style={{fontFamily:'var(--fd)',fontWeight:900,fontSize:mob?44:62,letterSpacing:-2,textTransform:'uppercase',lineHeight:1,color:'var(--white)'}}>DESCOPERƒÇ <span style={{color:'var(--red)'}}>ANIME</span></h1>
        <p style={{fontSize:12,color:'var(--grey2)',marginTop:6}}>Top anime via Jikan API</p>
      </div>
      <div style={{marginTop:20}}>
        <FilterBar options={[['top','Top Anime'],['airing','√én Difuzare'],['upcoming','Upcoming'],['popular','Popular']]} active={filter} onChange={filter}/>
      </div>
      <div style={{padding:mob?'28px 16px 60px':'38px clamp(16px,4vw,64px) 72px'}}>
        {loading?<div style={{textAlign:'center',padding:80,display:'flex',alignItems:'center',justifyContent:'center',gap:10,color:'var(--grey2)'}}><Spin size={24}/> Se √ÆncarcƒÉ...</div>:<Grid items={items} onCardClick={setModal} emptyMsg="EROARE API"/>}
      </div>
      {modal&&<Modal anime={modal} onClose={()=>setModal(null)}/>}
    </div>
  );
}

/* ‚îÄ‚îÄ‚îÄ APP ROOT ‚îÄ‚îÄ‚îÄ */
function App(){
  const[page,setPage]=useState('home');
  const[library,setLibrary]=useState(getLib);
  const[scrolled,setScrolled]=useState(false);

  useEffect(()=>{
    // Sync when admin panel changes localStorage (cross-tab)
    const sync=()=>setLibrary(getLib());
    window.addEventListener('storage',sync);
    // Poll for same-origin changes every 1.5s
    const id=setInterval(()=>{
      const fresh=getLib();
      setLibrary(prev=>JSON.stringify(prev)===JSON.stringify(fresh)?prev:fresh);
    },1500);
    return()=>{window.removeEventListener('storage',sync);clearInterval(id);};
  },[]);

  useEffect(()=>{
    const h=()=>setScrolled(window.scrollY>8);
    window.addEventListener('scroll',h,{passive:true});
    return()=>window.removeEventListener('scroll',h);
  },[]);

  // Fix discover filter onChange
  const handleSetPage=useCallback(p=>{setPage(p);window.scrollTo(0,0);},[]);

  return(
    <div>
      <Navbar page={page} setPage={handleSetPage} scrolled={scrolled||page!=='home'}/>
      {page==='home'&&<PageHome library={library} setPage={handleSetPage}/>}
      {page==='list'&&<PageList library={library}/>}
      {page==='discover'&&<PageDiscover library={library}/>}
      <MusicPlayer/>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>